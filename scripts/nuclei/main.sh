#!/usr/bin/env bash

read -p "file? → " input

nuclei --update-templates --silent
nuclei_templates=(
  "cnvd"
  "cves"
  "default-logins"
  "dns"
  "exposed-panels"
  "exposures"
  "file"
  "fuzzing"
  "headless"
  "helpers"
  "iot"
  "misconfiguration"
  "network"
  "takeovers"
  "technologies"
  "token-spray"
  "vulnerabilities"
  "workflows"
)

while IFS= read -r domain; do

  echo "→ Scan started for $domain"
  if [ -d nuclei/$domain ]; then
    continue
  else
    mkdir nuclei/$domain
  fi
  subfinder -d $domain | httpx >>nuclei/$domain/subdomains.txt

  for template in ${nuclei_templates[@]}; do
    echo "→ Scan for $template started"
    nuclei -l nuclei/$domain/subdomains.txt -t $template/ -o nuclei/$domain/$template.txt
  done

  echo "→ Scan completed for $domain"

done < ${input[@]}
